1.blog.data.txt 保存,删除时没有锁文件操作,导致在异步操作方式中会出现问题.
比如,同时异步方式删除blog1,blog2,由于是异步,执行顺序随机,如果blog2先删除,删除blog1时,异步删除方法都是先读取解析成JSON,此时JSON中是存在blog2的,而删除成功之后又会把blog2保存进去.
解决,对blogSchema增加队列和一个锁标示,执行具体操作时,把锁标示更新为锁定,其他操作时先判断锁标示是否锁定,是,就入队,否则,执行上述步骤.具体操作执行完成之后,判断队列是否存在其他操作,是,则取出执行,否,则更新锁标示为解锁.